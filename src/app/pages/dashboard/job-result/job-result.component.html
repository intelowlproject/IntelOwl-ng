<div>
  <ng-container *ngIf="isError">
    <h4>No data available for Job ID #{{ jobId }}.</h4>
  </ng-container>

  <ng-container *ngIf="jobObj; else loadingTemplate">
    <div [@refreshAnimation]="flashAnimBool" class="col-md-12 row">
      <!-- Job Information List -->
      <div class="col-md-5">
        <intelowl-job-info-list [jobObj]="jobObj"></intelowl-job-info-list>
      </div>

      <!-- Job Analysis Result Table -->
      <div class="col-md-7">
        <nb-alert *ngIf="jobObj?.status === 'running'" status="info">
          <span><nb-icon icon="info-outline"></nb-icon></span>
          <span
            >This analysis is still running. The result is synced with the
            server every 5 seconds.</span
          >
        </nb-alert>
        <nb-card>
          <nb-card-header
            id="analysis-reports-table"
            class="d-flex justify-content-between"
          >
            <span>Analysis Reports</span>
            <span
              >completed: {{ tableDataSource.count() }}/{{
                jobObj?.analyzers_to_execute.length
              }}</span
            >
          </nb-card-header>
          <nb-card-body>
            <ng2-smart-table
              nbTooltip="Click on a row to view it's result!"
              (userRowSelect)="onRowSelect($event)"
              [settings]="tableSettings"
              [source]="tableDataSource"
            >
            </ng2-smart-table>
          </nb-card-body>
        </nb-card>
      </div>
    </div>

    <!-- Selected Row's Result/Error -->

    <nb-card size="giant" id="selected-row-report" fullWidth>
      <nb-card-header>
        Selected: <strong>{{ selectedRowName }}</strong>
      </nb-card-header>
      <nb-card-body>
        <!-- JSON/code view -->
        <div id="result-json-viewer">
          <json-editor [debug]="true" [options]="editorOptions"></json-editor>
        </div>
        <!-- image view -->
        <div *ngIf="imageResult" id="result-image-viewer">
          <intelowl-image-visualizer
            [imageResult]="imageResult"
          ></intelowl-image-visualizer>
        </div>
      </nb-card-body>
    </nb-card>
  </ng-container>

  <button
    nbTooltip="Scroll To Top"
    id="goto-top-btn"
    nbButton
    size="medium"
    status="info"
    (click)="goToTop()"
  >
    <nb-icon icon="arrow-upward-outline"></nb-icon>
  </button>
</div>

<ng-template #loadingTemplate>
  <h4>Loading...</h4>
</ng-template>
